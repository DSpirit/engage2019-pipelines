parameters:  
  location: 'westeurope'

variables:
  functionAppName: $name-$(System.StageName)-${{ parameters.location }}

steps:
- download: current
  artifact: build
- download: current
  artifact: arm
- task: AzureCLI@2
  inputs:
    azureSubscription: 'Visual Studio Enterprise – MPN'
    scriptType: 'pscore'
    scriptLocation: 'scriptPath'
    scriptPath: '$(Pipeline.Workspace)/arm/deploy.ps1'
    arguments: '-location ${{ parameters.location }}'    
  
- task: AzureFunctionApp@1
  displayName: Deploy Function App
  inputs:
    azureSubscription: 'Visual Studio Enterprise – MPN'
    appType: 'functionApp'
    appName: $functionAppName
    package: '$(Pipeline.Workspace)/build/app.zip'
    deploymentMethod: 'auto'
